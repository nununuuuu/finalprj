# 雙均線趨勢策略 (Dual SMA with RSI Filter)

## 1. 策略核心概述

本策略屬於 **「順勢交易 (Trend Following)」** 類型，旨在捕捉中長期的股價上漲趨勢。
為了避免在趨勢末端追高，我們引入了 **RSI (相對強弱指標)** 作為濾網，確保進場時籌碼尚未過度擁擠，並在市場過熱時提早獲利了結。

---

## 2. 技術指標定義

本策略使用以下三個核心指標：

1.  **短期移動平均線 (SMA_Fast)**
    *   預設參數：`10` 日
    *   功能：反應近期的價格動能，對價格變化較敏感。
2.  **長期移動平均線 (SMA_Slow)**
    *   預設參數：`60` 日 (季線概念)
    *   功能：定義主要趨勢方向，過濾短期雜訊。
3.  **相對強弱指標 (RSI)**
    *   算法：採用 **Wilder's Smoothing** (與 TradingView/Yahoo Finance 一致)。
    *   功能：判斷市場是否處於「超買」或「超賣」狀態。
    *   **分離設定**：本策略允許針對「進場」與「出場」設定不同的 RSI 週期與閾值。

---

## 3. 交易邏輯詳解

### 進場條件 (Buy Signal)
當以下 **兩個條件同時成立** 時，執行買入：

1.  **黃金交叉 (Golden Cross)**：
    *   短期均線 (SMA_Fast) **由下往上突破** 長期均線 (SMA_Slow)。
    *   *意義*：確立短期動能強於長期趨勢，多頭行情啟動。
2.  **RSI 位階過濾**：
    *   進場 RSI 數值 **小於** 設定上限 (預設 70)。
    *   *意義*：確保進場時市場尚未「過熱」。若黃金交叉發生時 RSI 已經飆破 70，代表價格乖離過大，此時進場風險過高，故放棄該次訊號。

### 出場條件 (Sell Signal)
當滿足 **下列任一條件** 時，執行賣出 (平倉)：

1.  **死亡交叉 (Death Cross)**：
    *   短期均線 (SMA_Fast) **由上往下跌破** 長期均線 (SMA_Slow)。
    *   *意義*：趨勢反轉，多頭行情結束，保護本金。
2.  **RSI 過熱出場 (Overbought Exit)**：
    *   出場 RSI 數值 **大於** 設定觸發值 (預設 80)。
    *   *意義*：市場情緒過度亢奮，價格可能隨時回調，先行獲利了結，無需等待均線反轉。
3.  **停損 / 停利 (Stop Loss / Take Profit)**：
    *   觸發預設的百分比停損 (SL) 或 停利 (TP) 價位。
    *   *優先級*：高於上述技術指標出場。

---

## 4. 參數設定對照表

| 參數名稱 | 程式變數 (Python) | 預設值 | 說明 |
| :--- | :--- | :--- | :--- |
| 短均線週期 | `n1` (ma_short) | 10 | 短期趨勢判斷 |
| 長均線週期 | `n2` (ma_long) | 60 | 長期趨勢判斷 (季線) |
| 進場 RSI 週期 | `n_rsi_entry` | 14 | 用於進場判斷的 RSI 計算天數 |
| **進場 RSI 上限** | `rsi_buy_threshold` | **70** | RSI 高於此值時 **不買進** (避免追高) |
| 出場 RSI 週期 | `n_rsi_exit` | 14 | 用於出場判斷的 RSI 計算天數 |
| **出場 RSI 觸發** | `rsi_sell_threshold` | **80** | RSI 高於此值時 **強制賣出** (獲利了結) |

---

## 5. 策略優勢與潛在風險

###  優勢
*   **順勢而為**：利用均線交叉捕捉大波段行情，不僅僅是搶反彈。
*   **過熱保護**：RSI 濾網能有效過濾掉「假突破」或「末升段」的進場點。
*   **獲利鎖定**：新增的 RSI > 80 出場機制，能在股價急漲後迅速保住獲利，避免抱上抱下一場空。

###  風險
*   **盤整期磨損**：在股價橫盤整理時，均線容易頻繁交叉 (Whipsaw)，導致連續小額虧損。
*   **落後指標**：均線屬於落後指標，當出現死亡交叉時，股價通常已從高點回落一段距離。

---

## 6. 程式實作邏輯 (Python Mapping)

```python
def next(self):
    # 1. 檢查是否持有部位
    if self.position:
        # 出場 A: 死亡交叉 (趨勢反轉)
        if crossover(self.sma2, self.sma1):
            self.position.close()
        
        # 出場 B: RSI 過熱 (獲利了結)
        elif self.rsi_exit_line[-1] > self.rsi_sell_threshold:
             self.position.close()

    # 2. 檢查進場機會
    else:
        # 進場: 黃金交叉 AND RSI 未過熱
        if crossover(self.sma1, self.sma2) and \
           self.rsi_entry_line[-1] < self.rsi_buy_threshold:
            
            self.buy(sl=..., tp=...)